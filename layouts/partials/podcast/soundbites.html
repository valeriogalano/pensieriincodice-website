{{ $episodeBase := .File.BaseFileName }}
{{ $sbPath := printf "assets/soundbites/%s.txt" $episodeBase }}
{{ if fileExists $sbPath }}
    {{ $content := readFile $sbPath }}
    {{ $lines := split ($content | chomp) "\n" }}
    {{ range $lines }}
        {{- $line := . -}}
        {{- if gt (len ($line | plainify)) 0 -}}
            {{/* Split primario: TAB; fallback: spazio singolo */}}
            {{ $parts := split $line "\t" }}
            {{ if lt (len $parts) 3 }}
                {{ $sp := split $line " " }}
                {{ if ge (len $sp) 3 }}
                    {{ $parts = (slice (index $sp 0) (index $sp 1) (delimit (after 2 $sp) " ")) }}
                {{ end }}
            {{ end }}
            {{ if ge (len $parts) 3 }}
                {{ $startStr := trim (index $parts 0) " " }}
                {{ $endStr := trim (index $parts 1) " " }}
                {{/* Ricomponi il titolo per il caso TAB: unisci tutte le colonne dal terzo campo in poi */}}
                {{ $title := (index $parts 2) }}
                {{ if gt (len $parts) 3 }}
                    {{ $title = delimit (after 2 $parts) "\t" }}
                {{ end }}
                {{ $title = replace $title "\t" " " }}
                {{ $start := float $startStr }}
                {{ $end := float $endStr }}
                {{ $duration := sub $end $start }}
                {{ if gt $duration 0 }}
                    {{ $startAttr := printf "%g" $start }}
                    {{ $durAttr := printf "%g" $duration }}
                    <podcast:soundbite startTime="{{ $startAttr }}" duration="{{ $durAttr }}">{{ $title }}</podcast:soundbite>
                {{ end }}
            {{ end }}
        {{- end -}}
    {{ end }}
{{ end }}
