{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<rss version="2.0"
     xmlns:content="http://purl.org/rss/1.0/modules/content/"
     xmlns:wfw="http://wellformedweb.org/CommentAPI/"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
     xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
     xmlns:itunes="http://www.itunes.com/dtds/podcast-1.0.dtd"
     xmlns:googleplay="http://www.google.com/schemas/play-podcasts/1.0"
     xmlns:podcast="https://podcastindex.org/namespace/1.0">
    <channel>
        <atom:link href="{{ .Site.BaseURL }}podcast/index.xml" rel="self" type="application/rss+xml"/>
        <sy:updatePeriod>{{ .Site.Params.Podcast.updatePeriod }}</sy:updatePeriod>
        <sy:updateFrequency>{{ .Site.Params.Podcast.updateFrequency }}</sy:updateFrequency>
        <title>{{ .Site.Params.Podcast.title }}</title>
        <link>{{ .Site.BaseURL }}</link>
        <language>{{ .Site.LanguageCode }}</language>
        <category>{{ .Site.Params.Podcast.category }}</category>
        <lastBuildDate>{{ dateFormat "Mon, 2 Jan 2006 15:04:05 -0700" .Date }}</lastBuildDate>
        <copyright>{{ .Site.Params.Podcast.copyright | plainify }}</copyright>
        <image>
            <url>{{.Site.BaseURL}}{{ .Site.Params.Podcast.image }}</url>
            <title>{{ .Site.Params.Podcast.title }}</title>
            <link>{{ .Site.BaseURL }}</link>
        </image>
        <description>{{ .Site.Params.Podcast.summary | plainify }}</description>
        <generator>Hugo -- gohugo.io</generator>
        <itunes:subtitle>{{ .Site.Params.Podcast.subtitle }}</itunes:subtitle>
        <itunes:author>
            {{- range $index, $key:= .Site.Params.Podcast.authors -}}
            {{- if $index }}, {{ end -}}
            {{- if gt (len $key) 0 }}{{ $key }}{{ end -}}
            {{- end -}}
        </itunes:author>
        <itunes:type>{{ .Site.Params.Podcast.itunes_type }}</itunes:type>
        <itunes:summary>{{ .Site.Params.Podcast.summary | plainify }}</itunes:summary>
        <itunes:owner>
            <itunes:name>
                {{- range $index, $key:= .Site.Params.Podcast.authors -}}
                {{- if $index }}, {{ end -}}
                {{- if gt (len $key) 0 }}{{ $key }}{{ end -}}
                {{- end -}}
            </itunes:name>
            <itunes:email>{{ .Site.Params.Podcast.email }}</itunes:email>
        </itunes:owner>
        <itunes:image href="{{.Site.BaseURL}}{{ .Site.Params.Podcast.image }}"/>
        <itunes:category text="{{ .Site.Params.Podcast.category }}">
            {{- if .Site.Params.Podcast.sub_category -}}
            <itunes:category text="{{ .Site.Params.Podcast.sub_category }}"/>
            {{- end -}}
        </itunes:category>
        <itunes:block>no</itunes:block>
        <itunes:explicit>{{ .Site.Params.Podcast.explicit }}</itunes:explicit>
        <podcast:funding url="{{ .Site.Params.Podcast.funding_url }}">{{ .Site.Params.Podcast.funding_text }}
        </podcast:funding>
        {{- $pages := where .Site.RegularPages "Params.layout" "episode" -}}
        {{- $limit := .Site.Config.Services.RSS.Limit -}}
        {{- if ge $limit 1 -}}
        {{- $pages = $pages | first $limit -}}
        {{- end -}}
        {{- range $pages -}}
        <podcast:value type="lightning" method="keysend">
            <podcast:valueRecipient name="pensieriincodice@getalby.com" type="node"
                                    address="030a58b8653d32b99200a2334cfe913e51dc7d155aa0116c176657a4f1722677a3"
                                    customKey="696969" customValue="lxH8HcyLSi5uNgx7Jx9Z" split="100"/>
        </podcast:value>
        <item>
            <title>{{ title .Params.title }}{{ with .Params.subtitle }} ({{ . }}){{ end }}</title>
            {{ $audio_name_arr := split .Params.audio "." }}
            {{ $audio_type := index $audio_name_arr (sub (len $audio_name_arr) 1) }}
            {{ $audio_size := 1 }}
            {{- if .Params.audio_size }}{{ $audio_size = int .Params.audio_size }} {{ end -}}
            <enclosure url="{{ .Site.Params.Podcast.cdn_base_url }}{{ .Params.audio }}" length="{{ $audio_size }}"
                       type="audio/{{ $audio_type }}"/>
            <guid>{{ .Site.Params.Podcast.cdn_base_url }}{{ .Params.audio }}</guid>
            <link>{{ .Permalink }}</link>
            <pubDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" | safeHTML }}</pubDate>
            {{- if strings.Contains .Content "<!-- more -->" -}}
            {{ $target := split .Content "<!-- more -->" }}
            {{ $cutted_desc := index ($target) 0 }}
            <description>{{ print "<![CDATA[" $cutted_desc | safeHTML | truncate 3000 }}{{ print "]]>" | safeHTML }}
            </description>
            <googleplay:description>{{ print "<![CDATA[" $cutted_desc | safeHTML | truncate 3000 }}{{ print "]]>" |
                safeHTML }}
            </googleplay:description>
            <content:encoded>{{ print "<![CDATA[" $cutted_desc | safeHTML | truncate 3000 }}{{ print "]]>" | safeHTML
                }}
            </content:encoded>
            {{- else -}}
            <description>{{ print "<![CDATA[" .Content | safeHTML | truncate 3000 }}{{ print "]]>" | safeHTML }}
            </description>
            <googleplay:description>{{ print "<![CDATA[" .Content | safeHTML | truncate 3000 }}{{ print "]]>" | safeHTML
                }}
            </googleplay:description>
            <content:encoded>{{ print "<![CDATA[" .Content | safeHTML | truncate 3000 }}{{ print "]]>" | safeHTML }}
            </content:encoded>
            {{- end -}}
            <itunes:author>
                {{- range $index, $key:= .Params.authors -}}
                {{- if $index }}, {{ end -}}
                {{- if gt (len $key) 0 }}{{ $key }}{{ end -}}
                {{- end -}}
            </itunes:author>
            <itunes:summary>{{ .Summary | plainify }}</itunes:summary>
            <itunes:explicit>{{ .Params.explicit }}</itunes:explicit>
            <itunes:episodeType>{{ .Params.episode_type | default "full" }}</itunes:episodeType>
            {{- if .Params.season -}}
            <itunes:season>{{ .Params.season }}</itunes:season>
            {{- end -}}
            {{- if .Params.tags -}}
            <itunes:keywords>
                {{- range $index, $key:= .Params.tags -}}
                {{- if $index }}, {{ end -}}
                {{ $key }}
                {{- end -}}
            </itunes:keywords>
            {{- end -}}
            {{ with .Params.audio_duration }}<itunes:duration>{{ . }}</itunes:duration>{{ end }}
            {{- if .Params.image -}}
            <itunes:image href="{{ .Site.Params.Podcast.cdn_base_url }}{{ .Params.image }}"/>
            {{- else -}}
            <itunes:image href="{{ .Site.Params.Podcast.image }}"/>
            {{- end -}}
            <podcast:transcript url="{{ .Site.Params.Podcast.cdn_base_url }}{{ .Params.transcript }}"
                                type="application/x-subrip" language="it"/>
        </item>
        {{ end }}
    </channel>
</rss>
